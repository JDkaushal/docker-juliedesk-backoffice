window.trackEvent = function(event, params, callback) {
    $.ajax({
        type: 'POST',
        url: 'https://jd-backoffice-analytics.herokuapp.com/api/v1/track',
        crossDomain: true,
        data: {name: event, date: (new Date()).toISOString(), properties: params, distinct_id: params.distinct_id},
        beforeSend: function(xhr){xhr.setRequestHeader('Authorization', "<%= ENV['JD_BACKOFFICE_API_KEY'] %>");},
        dataType: 'json',
        success: function(responseData, textStatus, jqXHR) {
            callback();
        },
        error: function (responseData, textStatus, errorThrown) {
            callback();
        }
    });
};

window.trackFormSubmit = function(selector, event, params) {
    //TODO: Implement
};

function trackActionV2(type, extraParams) {
    try {
        var messageContainerNode = $('#messages_container');
        var messagesThreadId = messageContainerNode.data('messagesThreadId');
        var selectedMessage = $('.email.highlighted');

        var defaultParams = {
            distinct_id: messageContainerNode.data('operatorId') + '-' + messagesThreadId,
            thread_id: messagesThreadId,
            thread_messages_count: messageContainerNode.data('messagesCount'),
            bo_message_id: selectedMessage.data('messageId')
        };

        trackEvent(type, $.extend(defaultParams, extraParams), function(){})
    }
    catch(err) {
        console.log(err);
    }
}