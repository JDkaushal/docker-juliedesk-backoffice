<script>
    window.drawCalendarCallback = function(){
        window.activateCalendarWithParams({
            mode: "select_events",
            date_times: [],
            email: window.threadAccount.email,
            duration: window.threadComputedData.duration
        });
        // We don't want to directly show the calendar when forwarding to a client
        $(".calendar-container").addClass("minimized");
    };

  $(function() {
      $("#reply-button").show();
      $("#forward-button").hide();

      $("input#quote_message").prop("checked", true).prop("disabled", true);

      $(".forward-to-support-menu-button").click(function() {
          $(".forward-to-support-menu").toggle();
      });


      $(".forward-to-support-menu").on("click", ".forward-to-support-menu-item", function() {
          var $button = $(this);
          clickOnTemplateItem($button);
      });
  });

    function clickOnTemplateItem($item) {
        <% if @messages_thread.account.locale == "fr" %>
        var template = $item.data("template-fr");
        <% else %>
        var template = $item.data("template-en");
        <% end %>
        window.setReplyMessage(template, "only_client", ["support@juliedesk.com"]);
        $(".forward-to-support-menu").hide();
    }

    window.afterReplyBoxInitCallback = function(){
        var messageBuilder = $('#reply-area').scope();

        window.setReplyMessage("", "only_client", ["support@juliedesk.com"]);

        host = "<%= "https://juliedesk-app.herokuapp.com" %>";
        var access_key = "<%= ENV['JULIEDESK_APP_API_KEY'] %>";

        $.ajax({
            url: host + "/api/v1/julie_templates",
            type: "GET",
            contentType: "application/json",
            beforeSend: function (xhr) {
                xhr.setRequestHeader("Authorization", access_key);
            },
            success: function (response) {
                var data = response.data;
                $(".forward-to-support-menu").html("").hide();
                _(data).each(function (item) {
                    var $menuItem = $("<div>").addClass("forward-to-support-menu-item").html(item.title).data("template-en", item.template_en).data("template-fr", item.template_fr);
                    $(".forward-to-support-menu").append($menuItem);
                });


                setTimeout(function() {
                    clickOnTemplateItem($(".forward-to-support-menu-item:eq(0)"));
                }, 500);
            }
        });
    };
</script>